/*!
* Bootstrap-Extensions.js by Ivan Kerin 
* Copyright 2013 OpenBuildings, Inc.
* http://www.apache.org/licenses/LICENSE-2.0.txt
*/
!function(e){"use strict";var t=function(t,n){var r=e(t);r.on("dragstart",function(t){e(t.currentTarget).data("current",t.target).data("x",t.originalEvent.clientX).data("y",t.originalEvent.clientY)}),r.on("dragover",function(e){e.preventDefault()}),r.on("drop",function(t){var n=e(e(t.currentTarget).data("current")),r=n.position().left+t.originalEvent.clientX-e(t.currentTarget).data("x"),i=n.position().top+t.originalEvent.clientY-e(t.currentTarget).data("y");n.css({left:r/e(t.currentTarget).width()*100+"%",top:i/e(t.currentTarget).height()*100+"%"}),n.find('[data-draggable="left"]').val(r/e(t.currentTarget).width()*100),n.find('[data-draggable="top"]').val(i/e(t.currentTarget).height()*100)})};t.prototype={constructor:t};var n=e.fn.draggable;e.fn.draggable=function(n){return this.each(function(){var r=e(this),i=r.data("draggable"),s=typeof n=="object"&&n;i||r.data("draggable",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.draggable.Constructor=t,e.fn.draggable.noConflict=function(){return e.fn.draggable=n,this},e(function(){e(document).on("mouseover.draggable.data-api",'[data-provide="draggable"]',function(t){var n=e(this);if(n.data("draggable"))return;t.preventDefault(),n.draggable(n.data())})})}(window.jQuery),!function(e){"use strict";var t=function(t,n){this.$element=e(t),this.type=this.$element.data("uploadtype")||(this.$element.find(".thumbnail").length>0?"image":"file"),this.$input=this.$element.find(":file");if(this.$input.length===0)return;this.name=this.$input.attr("name")||n.name,this.$hidden=this.$element.find('input[type=hidden][name="'+this.name+'"]'),this.$hidden.length===0&&(this.$hidden=e('<input type="hidden" />'),this.$element.prepend(this.$hidden)),this.$preview=this.$element.find(".fileupload-preview");var r=this.$preview.css("height");this.$preview.css("display")!="inline"&&r!="0px"&&r!="none"&&this.$preview.css("line-height",r),this.original={exists:this.$element.hasClass("fileupload-exists"),preview:this.$preview.html(),hiddenVal:this.$hidden.val()},this.$remove=this.$element.find('[data-dismiss="fileupload"]'),this.$element.find('[data-trigger="fileupload"]').on("click.fileupload",e.proxy(this.trigger,this)),this.listen()};t.prototype={listen:function(){this.$input.on("change.fileupload",e.proxy(this.change,this)),e(this.$input[0].form).on("reset.fileupload",e.proxy(this.reset,this)),this.$remove&&this.$remove.on("click.fileupload",e.proxy(this.clear,this))},change:function(e,t){if(t==="clear")return;var n=e.target.files!==undefined?e.target.files[0]:e.target.value?{name:e.target.value.replace(/^.+\\/,"")}:null;if(!n){this.clear();return}this.$hidden.val(""),this.$hidden.attr("name",""),this.$input.attr("name",this.name);if(this.type==="image"&&this.$preview.length>0&&(typeof n.type!="undefined"?n.type.match("image.*"):n.name.match(/\.(gif|png|jpe?g)$/i))&&typeof FileReader!="undefined"){var r=new FileReader,i=this.$preview,s=this.$element;r.onload=function(e){i.html('<img src="'+e.target.result+'" '+(i.css("max-height")!="none"?'style="max-height: '+i.css("max-height")+';"':"")+" />"),s.addClass("fileupload-exists").removeClass("fileupload-new")},r.readAsDataURL(n)}else this.$preview.text(n.name),this.$element.addClass("fileupload-exists").removeClass("fileupload-new")},clear:function(e){this.$hidden.val(""),this.$hidden.attr("name",this.name),this.$input.attr("name","");if(navigator.userAgent.match(/msie/i)){var t=this.$input.clone(!0);this.$input.after(t),this.$input.remove(),this.$input=t}else this.$input.val("");this.$preview.html(""),this.$element.addClass("fileupload-new").removeClass("fileupload-exists"),e&&(this.$input.trigger("change",["clear"]),e.preventDefault())},reset:function(e){this.clear(),this.$hidden.val(this.original.hiddenVal),this.$preview.html(this.original.preview),this.original.exists?this.$element.addClass("fileupload-exists").removeClass("fileupload-new"):this.$element.addClass("fileupload-new").removeClass("fileupload-exists")},trigger:function(e){this.$input.trigger("click"),e.preventDefault()}},e.fn.fileupload=function(n){return this.each(function(){var r=e(this),i=r.data("fileupload");i||r.data("fileupload",i=new t(this,n)),typeof n=="string"&&i[n]()})},e.fn.fileupload.Constructor=t,e(document).on("click.fileupload.data-api",'[data-provides="fileupload"]',function(t){var n=e(this);if(n.data("fileupload"))return;n.fileupload(n.data());var r=e(t.target).closest('[data-dismiss="fileupload"],[data-trigger="fileupload"]');r.length>0&&(r.trigger("click.fileupload"),t.preventDefault())})}(window.jQuery),!function(e){"use strict";var t=function(t,n){var r=e(t);r.on("dragstart",function(t){var r=t.target;e(n.dropzone).addClass("drop-target").height(e(n.dropzone).closest(".row-fluid").height()).data("href",e(r).data("href"))}).on("dragover",function(e){e.preventDefault()}).on("dragend",function(t){e(n.dropzone).removeClass("drop-target").data("href",!1)}),e(n.dropzone).on("dragover",function(e){e.preventDefault()}).on("drop",function(t){return e(t.currentTarget).data("href")&&(window.location=e(t.currentTarget).data("href")),!1})};t.prototype={constructor:t};var n=e.fn.filters;e.fn.filters=function(n){return this.each(function(){var r=e(this),i=r.data("filters"),s=typeof n=="object"&&n;i||r.data("filters",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.filters.Constructor=t,e.fn.filters.noConflict=function(){return e.fn.filters=n,this},e(function(){e(document).on("mouseover.filters.data-api",'[data-provide="filters"]',function(t){var n=e(this);if(n.data("filters"))return;t.preventDefault(),n.filters(n.data())})})}(window.jQuery),!function(e){"use strict";var t=function(t,n){this.$element=e(t)};t.prototype={constructor:t,reindex:function(){var t=this.$element;t.children(".multiform").each(function(n){e("input,select,textarea").each(function(){var r=new RegExp(t.attr("data-index").replace(/[\-\[\]\/\(\)\*\+\?\.\\\^\$\|]/g,"\\$&").replace("{{index}}","(\\d+)"));e(this).attr("name",e(this).attr("name").replace(r,t.attr("data-index").replace("{{index}}",n)))})})},add:function(t){e('<div class="multiform fade"></div>').html(e(t).clone().html()).prependTo(this.$element).addClass("in"),this.$element.multiform("reindex")}};var n=e.fn.multiform;e.fn.multiform=function(n,r){return this.each(function(){var i=e(this),s=i.data("multiform"),o=typeof n=="object"&&n;s||i.data("multiform",s=new t(this,o)),typeof n=="string"&&s[n](r)})},e.fn.multiform.Constructor=t,e.fn.multiform.noConflict=function(){return e.fn.multiform=n,this},e(function(){e(document).on("click.multiform.data-api","[data-multiform-add]",function(t){var n=e(e(this).data("multiformAdd"));t.preventDefault(),n.multiform("add",e(this).attr("href"))}),e(document).on("click.multiform.data-api",'[data-dismiss="multiform"]',function(t){function i(){n.remove(),r.multiform("reindex")}var n=e(this).closest(".multiform"),r=n.parent();t.preventDefault(),e.support.transition?n.addClass("fade").removeClass("in").on(e.support.transition.end,i):i()})})}(window.jQuery),!function(e){"use strict";var t=function(t,n){var r=this.$element=e(t);this.url=n.url,this.count=n.count||e(n.container).children().length,this.$container=e(n.container),this.$element.typeahead({source:{url:n.source,dataType:"json"},val:{},itemSelected:function(t){n.overwrite&&(e(n.container).empty(),r.addClass("hide")),r.val("").remoteselect("add",t.id,t.model)}})};t.prototype={constructor:t,add:function(t,n){var r=this.$container;e.get(this.url.replace("{{id}}",t).replace("{{count}}",this.count++).replace("{{model}}",n),function(t){r.append(t),e(".chzn-select").chosen()})}};var n=e.fn.remoteselect;e.fn.remoteselect=function(n,r,i){return this.each(function(){var s=e(this),o=s.data("remoteselect"),u=typeof n=="object"&&n;o||s.data("remoteselect",o=new t(this,u||s.data())),typeof n=="string"&&o[n](r,i)})},e.fn.remoteselect.Constructor=t,e.fn.remoteselect.noConflict=function(){return e.fn.remoteselect=n,this},e(function(){e(document).on("focus.remoteselect.data-api",'[data-provide="remoteselect"]',function(t){var n=e(this);if(n.data("remoteselect"))return;t.preventDefault(),n.remoteselect(n.data())}),e(document).on("click.remoteselect.data-api",'[data-dismiss="remoteselect"]',function(t){function r(){e('input[data-container="#'+n.parent().attr("id")+'"]').removeClass("hide").addClass("in"),n.remove()}var n=e(this).closest(".remoteselect-item");t.preventDefault(),e.support.transition?n.addClass("fade").on(e.support.transition.end,r):r()}),e(document).on("click.remoteselect.data-api","[data-remoteselect-new]",function(t){var n=e(this).siblings('[data-provide="remoteselect"]');t.preventDefault(),n.remoteselect("add",null,n.data("remoteselectNew"))})})}(window.jQuery),!function(e){"use strict";var t=function(t){this.element=e(t)};t.prototype={constructor:t,show:function(){function o(){n.removeClass("active"),r.addClass("active"),s?r.addClass("in"):r.removeClass("fade"),t.trigger({type:"shown",target:r,relatedTarget:n})}var t=this.element,n=e(t.data("previous")),r=e("#"+t.val()),i,s=e.support.transition&&r.hasClass("fade");if(r.hasClass("active"))return;i=e.Event("show",{target:r,relatedTarget:n}),t.trigger(i);if(i.isDefaultPrevented())return;s?n.one(e.support.transition.end,o):o(),n.removeClass("in"),t.data("previous","#"+t.val())}};var n=e.fn.selecttab;e.fn.selecttab=function(n){return this.each(function(){var r=e(this),i=r.data("selecttab");i||r.data("selecttab",i=new t(this)),typeof n=="string"&&i[n]()})},e.fn.selecttab.Constructor=t,e.fn.selecttab.noConflict=function(){return e.fn.selecttab=n,this},e(document).on("change.selecttab.data-api",'[data-provide="selecttab"]',function(t){t.preventDefault(),e(this).selecttab("show")})}(window.jQuery),!function(e){"use strict";function t(t,n){return e(t).data("sortableId")||e(t).find(n).data("sortableId")}var n=function(t,n){this.options=e.extend({},e.fn.sortable.defaults,n),this.$element=e(t).addClass(this.options.containerClass),this.handle=!1,this.$element.data("items")&&this.$element.find(this.$element.data("items")).attr("draggable","true");if(this.$element.data("placeholder")){var r=this.$element.find(this.options.items).eq(1);this.$placeholder=r.clone().height(r.height()),this.$placeholder.find("td").empty().end().addClass("sortable-placeholder").attr("draggable","true")}this.listen()};n.prototype={constructor:n,listen:function(){var n=this;this.$element.on("dragover",function(e){e.preventDefault()}),this.$element.data("handle")&&e(document).on("mousedown",this.$element.data("handle"),function(e){n.handle=!0}).on("mouseup",this.$element.data("handle"),function(e){n.handle=!1}),e(document).on("dragstart",this.options.items,function(t){if(n.$element.data("handle")&&!n.handle)return!1;n.$current=e(t.currentTarget)}).on("dragend",this.options.items,function(){n.$placeholder&&(n.$current.show(),n.$placeholder.detach())}).on("dragenter",this.options.items,function(t){n.$placeholder?(n.$current.hide(),t.originalEvent.pageY>e(t.currentTarget).offset().top-e(t.currentTarget).height()&&(n.$placeholder.detach(),e(t.currentTarget).after(n.$placeholder.addClass("drop-target")))):(n.$element.find(".drop-target").removeClass("drop-target"),e(t.currentTarget).addClass("drop-target"))}).on("drop",this.options.items,function(r){if(n.$placeholder){if(n.$placeholder.prev().length){var i=n.$placeholder.prev().index()?n.$placeholder.prev():n.$placeholder.next();e.ajax([n.$element.data("sortUrl"),"&from=",t(n.$current,n.$element.data("handle")),"&to=",t(i,n.$element.data("handle"))].join(""))}n.$placeholder.before(n.$current.clone().show()),n.$current.remove(),n.$placeholder.detach()}else n.$current.insertBefore(e(r.currentTarget).removeClass("drop-target")),n.$element.children().each(function(t){e(this).find('[data-sortable="position"]').val(t)})})}};var r=e.fn.sortable;e.fn.sortable=function(t){return this.each(function(){var r=e(this),i=r.data("sortable"),s=typeof t=="object"&&t;i||r.data("sortable",i=new n(this,s)),typeof t=="string"&&i[t]()})},e.fn.sortable.defaults={containerClass:"sortable-container",items:"[draggable]"},e.fn.sortable.Constructor=n,e.fn.sortable.noConflict=function(){return e.fn.sortable=r,this},e(function(){e(document).on("mouseover.sortable.data-api",'[data-provide="sortable"]',function(t){var n=e(this);if(n.data("sortable"))return;t.preventDefault(),n.sortable(n.data())})})}(window.jQuery),!function(e){"use strict";var t={source:[],maxResults:8,minLength:1,menu:'<ul class="typeahead dropdown-menu"></ul>',item:'<li><a href="#"></a></li>',display:"name",val:"id",itemSelected:function(){}},n={DOWN:40,ENTER:13,ESCAPE:27,TAB:9,UP:38},r=function(t,n){this.$element=e(t),this.options=e.extend(!0,{},e.fn.typeahead.defaults,n),this.$menu=e(this.options.menu).appendTo("body"),this.sorter=this.options.sorter||this.sorter,this.highlighter=this.options.highlighter||this.highlighter,this.shown=!1,this.initSource(),this.listen()};r.prototype={constructor:r,initSource:function(){this.options.source&&(typeof this.options.source=="string"?this.source=e.extend({},e.ajaxSettings,{url:this.options.source}):typeof this.options.source=="object"&&(this.options.source instanceof Array?this.source=this.options.source:this.source=e.extend(!0,{},e.ajaxSettings,this.options.source)))},eventSupported:function(e){var t=e in this.$element;return t||(this.$element.setAttribute(e,"return;"),t=typeof this.$element[e]=="function"),t},lookup:function(t){var n=this,r;this.query=this.$element.val();if(!this.query||this.query.length<this.options.minLength)return this.shown?this.hide():this;this.source.url?(this.xhr&&this.xhr.abort(),this.xhr=e.ajax(e.extend({},this.source,{data:{query:n.query},success:e.proxy(n.filter,n)}))):r=e.proxy(n.filter(n.source),n)},filter:function(t){var n=this,r;return r=e.grep(t,function(e){return~e[n.options.display].toLowerCase().indexOf(n.query.toLowerCase())}),!r||!r.length?this.shown?this.hide():this:(r=r.slice(0,this.options.maxResults),this.render(this.sorter(r)).show())},sorter:function(e){var t=this,n=[],r=[],i=[],s;while(s=e.shift())s[t.options.display].toLowerCase().indexOf(this.query.toLowerCase())?~s[t.options.display].indexOf(this.query)?r.push(s):i.push(s):n.push(s);return n.concat(r,i)},show:function(){var t=e.extend({},this.$element.offset(),{height:this.$element[0].offsetHeight});return this.$menu.css({top:t.top+t.height,left:t.left}),this.$menu.show(),this.shown=!0,this},hide:function(){return this.$menu.hide(),this.shown=!1,this},highlighter:function(e){var t=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return e.replace(new RegExp("("+t+")","ig"),function(e,t){return"<strong>"+t+"</strong>"})},render:function(t){var n=this,r,i;return t=e(t).map(function(t,s){return n.options.tmpl?t=e(n.options.tmpl(s)):t=e(n.options.item),typeof n.options.val=="string"?t.attr("data-value",s[n.options.val]):t.attr("data-value",JSON.stringify(e.extend({},n.options.val,s))),r=s[n.options.display],i=t.find("a"),r.indexOf("typeahead-display-val")>0?i.html(r).find(".typeahead-display-val").each(function(){e(this).html(n.highlighter(e(this).html()))}):i.html(n.highlighter(r)),t[0]}),t.first().addClass("active"),setTimeout(function(){n.$menu.html(t)},250),this},select:function(){var e=this.$menu.find(".active");return this.$element.val(e.text()).change(),this.options.itemSelected(JSON.parse(e.attr("data-value"))),this.hide()},next:function(t){var n=this.$menu.find(".active").removeClass("active"),r=n.next();r.length||(r=e(this.$menu.find("li")[0])),r.addClass("active")},prev:function(e){var t=this.$menu.find(".active").removeClass("active"),n=t.prev();n.length||(n=this.$menu.find("li").last()),n.addClass("active")},listen:function(){this.$element.on("blur",e.proxy(this.blur,this)).on("keyup",e.proxy(this.keyup,this)),this.eventSupported("keydown")?this.$element.on("keydown",e.proxy(this.keypress,this)):this.$element.on("keypress",e.proxy(this.keypress,this)),this.$menu.on("click",e.proxy(this.click,this)).on("mouseenter","li",e.proxy(this.mouseenter,this))},keyup:function(e){e.stopPropagation(),e.preventDefault();switch(e.keyCode){case n.DOWN:case n.UP:break;case n.TAB:case n.ENTER:if(!this.shown)return;this.select();break;case n.ESCAPE:this.hide();break;default:this.lookup()}},keypress:function(e){e.stopPropagation();if(!this.shown)return;switch(e.keyCode){case n.TAB:case n.ESCAPE:case n.ENTER:e.preventDefault();break;case n.UP:e.preventDefault(),this.prev();break;case n.DOWN:e.preventDefault(),this.next()}},blur:function(e){var t=this;e.stopPropagation(),e.preventDefault(),setTimeout(function(){t.$menu.is(":focus")||t.hide()},150)},click:function(e){e.stopPropagation(),e.preventDefault(),this.select()},mouseenter:function(t){this.$menu.find(".active").removeClass("active"),e(t.currentTarget).addClass("active")}},e.fn.typeahead=function(t){return this.each(function(){var n=e(this),i=n.data("typeahead"),s=typeof t=="object"&&t;i||n.data("typeahead",i=new r(this,s)),typeof t=="string"&&i[t]()})},e.fn.typeahead.defaults=t,e.fn.typeahead.Constructor=r,e(function(){e("body").on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(t){var n=e(this);if(n.data("typeahead"))return;t.preventDefault(),n.typeahead(n.data())})})}(window.jQuery);